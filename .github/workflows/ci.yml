name: POC sonarqube

on:
  push:
    branches: [ ci ]

jobs:
  QA-Analysis:
    runs-on: ubuntu-latest

    steps:
      -
        name: Checkout
        uses: actions/checkout@v2
      - name: Build with Maven
        run: |
          mvn clean package

      - name: Depcheck - HTML
        uses: dependency-check/Dependency-Check_Action@main
        id: DepcheckHTML
        with:
          project: 'Project-DDD'
          report-dir: 'target/dependency-check-report'
          path: '.'
          format: 'HTML'
          args: >
            --failOnCVSS 7
            --enableRetired

      - name: Depcheck - XML
        uses: dependency-check/Dependency-Check_Action@main
        id: DepcheckXML
        with:
          project: 'Project-DDD'
          report-dir: 'target/dependency-check-report'
          path: '.'
          format: 'XML'
          args: >
            --failOnCVSS 7
            --enableRetired

      - name: Depcheck - JSON
        uses: dependency-check/Dependency-Check_Action@main
        id: DepcheckJSON
        with:
          project: 'Project-DDD'
          report-dir: 'target/dependency-check-report'
          path: '.'
          format: 'JSON'
          args: >
            --failOnCVSS 7
            --enableRetired

      - name: list of files
        run: |
          ls -l target/

      - name: Upload Test results
        uses: actions/upload-artifact@master
        with:
          name: Dependency-Check-Report
          path: ${{github.workspace}}/target/dependency-check-report

      - name: SonarQube Scan
        uses: sonarsource/sonarqube-scan-action@master
        env:
          SONAR_TOKEN: ${{ secrets.SONARQUBE_TOKEN }}
          SONAR_HOST_URL: ${{ secrets.SONARQUBE_HOST }}
